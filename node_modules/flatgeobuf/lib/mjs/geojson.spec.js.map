{"version":3,"sources":["../../../../src/ts/geojson.spec.ts"],"sourcesContent":["import { readFileSync } from 'node:fs';\nimport type {\n    FeatureCollection as GeoJsonFeatureCollection,\n    LineString,\n    MultiLineString,\n    MultiPoint,\n    MultiPolygon,\n    Point,\n    Polygon,\n    Position,\n} from 'geojson';\nimport GeometryFactory from 'jsts/org/locationtech/jts/geom/GeometryFactory.js';\nimport GeoJSONWriter from 'jsts/org/locationtech/jts/io/GeoJSONWriter.js';\nimport WKTReader from 'jsts/org/locationtech/jts/io/WKTReader.js';\nimport { describe, expect, it } from 'vitest';\nimport type { IGeoJsonFeature } from './geojson/feature.js';\nimport { deserialize, serialize } from './geojson.js';\nimport type { HeaderMeta } from './header-meta.js';\nimport type { Rect } from './packedrtree.js';\nimport { arrayToStream, takeAsync } from './streams/utils.js';\n\nfunction makeFeatureCollection(\n    wkt: string,\n    properties?: Record<string, string | number | boolean | object | Uint8Array | undefined>,\n) {\n    return makeFeatureCollectionFromArray([wkt], properties);\n}\n\nfunction makeFeatureCollectionFromArray(\n    wkts: string[],\n    properties?: Record<string, string | number | boolean | object | Uint8Array | undefined>,\n) {\n    const reader = new WKTReader(new GeometryFactory());\n    const writer = new GeoJSONWriter();\n    const geometries = wkts.map((wkt) => writer.write(reader.read(wkt)));\n    const features = geometries.map(\n        (geometry, index) =>\n            ({\n                type: 'Feature',\n                id: index,\n                geometry,\n                properties: {},\n            }) as IGeoJsonFeature,\n    );\n    if (properties) for (const f of features) f.properties = properties;\n    return {\n        type: 'FeatureCollection',\n        features,\n    } as GeoJsonFeatureCollection;\n}\n\ndescribe('geojson module', () => {\n    describe('Geometry roundtrips', () => {\n        it('Point', async () => {\n            const expected = makeFeatureCollection('POINT(1.2 -2.1)');\n            const s = serialize(expected);\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(s));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('Point 3D', async () => {\n            const expected = makeFeatureCollection('POINT Z(1.2 -2.1 10)');\n            const s = serialize(expected);\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(s));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('Point via stream', async () => {\n            const expected = makeFeatureCollection('POINT(1.2 -2.1)');\n            const s = serialize(expected);\n            const stream = arrayToStream(s);\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(stream));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('Points', async () => {\n            const expected = makeFeatureCollectionFromArray(['POINT(1.2 -2.1)', 'POINT(2.4 -4.8)']);\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('MultiPoint', async () => {\n            const expected = makeFeatureCollection('MULTIPOINT(10 40, 40 30, 20 20, 30 10)');\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('LineString', async () => {\n            const expected = makeFeatureCollection('LINESTRING(1.2 -2.1, 2.4 -4.8)');\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('LineString 3D', async () => {\n            const expected = makeFeatureCollection('LINESTRING Z(1.2 -2.1 1.1, 2.4 -4.8 1.2)');\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('MultiLineString', async () => {\n            const expected = makeFeatureCollection(`MULTILINESTRING((10 10, 20 20, 10 40),\n (40 40, 30 30, 40 20, 30 10), (50 50, 60 60, 50 90))`);\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('MultiLineStringSinglePart', async () => {\n            const expected = makeFeatureCollection('MULTILINESTRING((1.2 -2.1, 2.4 -4.8))');\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('Polygon', async () => {\n            const expected = makeFeatureCollection('POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))');\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('Polygon via stream', async () => {\n            const expected = makeFeatureCollection('POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))');\n            const s = serialize(expected);\n            const stream = arrayToStream(s);\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(stream));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('PolygonWithHole', async () => {\n            const expected = makeFeatureCollection(`POLYGON ((35 10, 45 45, 15 40, 10 20, 35 10),\n (20 30, 35 35, 30 20, 20 30))`);\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('PolygonWithHole 3D', async () => {\n            const expected = makeFeatureCollection(`POLYGON Z((35 10 3, 45 45 4, 15 40 5, 10 20 6, 35 10 7),\n (20 30 3, 35 35 4, 30 20 5, 20 30 6))`);\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('MultiPolygon', async () => {\n            const expected = makeFeatureCollection(`MULTIPOLYGON (((30 20, 45 40, 10 40, 30 20)),\n ((15 5, 40 10, 10 20, 5 10, 15 5)))`);\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('MultiPolygonWithHole', async () => {\n            const expected = makeFeatureCollection(`MULTIPOLYGON (((40 40, 20 45, 45 30, 40 40)),\n ((20 35, 10 30, 10 10, 30 5, 45 20, 20 35), (30 20, 20 15, 20 25, 30 20)))`);\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            // NOTE: 28 flat coords, ends = [4, 10, 14], endss = [1, 2]\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('MultiPolygonSinglePart', async () => {\n            const expected = makeFeatureCollection('MULTIPOLYGON (((30 20, 45 40, 10 40, 30 20)))');\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('MultiPolygonSinglePartWithHole', async () => {\n            const expected = makeFeatureCollection(`MULTIPOLYGON (((35 10, 45 45, 15 40, 10 20, 35 10),\n (20 30, 35 35, 30 20, 20 30))))`);\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            // NOTE: 18 flat coords, ends = [5, 9], endss = null\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('GeometryCollection', async () => {\n            const expected = makeFeatureCollection('GEOMETRYCOLLECTION(POINT(4 6),LINESTRING(4 6,7 10))');\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('GeometryCollection 3D', async () => {\n            const expected = makeFeatureCollection('GEOMETRYCOLLECTION Z(POINT Z(4 6 3),LINESTRING Z(4 6 4,7 10 5))');\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('Bahamas', async () => {\n            const expected: GeoJsonFeatureCollection = {\n                type: 'FeatureCollection',\n                features: [\n                    {\n                        type: 'Feature',\n                        id: 0,\n                        properties: { name: 'The Bahamas' },\n                        geometry: {\n                            type: 'MultiPolygon',\n                            coordinates: [\n                                [\n                                    [\n                                        [-77.53466, 23.75975],\n                                        [-77.78, 23.71],\n                                        [-78.03405, 24.28615],\n                                        [-78.40848, 24.57564],\n                                        [-78.19087, 25.2103],\n                                        [-77.89, 25.17],\n                                        [-77.54, 24.34],\n                                        [-77.53466, 23.75975],\n                                    ],\n                                ],\n                                [\n                                    [\n                                        [-77.82, 26.58],\n                                        [-78.91, 26.42],\n                                        [-78.98, 26.79],\n                                        [-78.51, 26.87],\n                                        [-77.85, 26.84],\n                                        [-77.82, 26.58],\n                                    ],\n                                ],\n                                [\n                                    [\n                                        [-77, 26.59],\n                                        [-77.17255, 25.87918],\n                                        [-77.35641, 26.00735],\n                                        [-77.34, 26.53],\n                                        [-77.78802, 26.92516],\n                                        [-77.79, 27.04],\n                                        [-77, 26.59],\n                                    ],\n                                ],\n                            ],\n                        },\n                    },\n                ],\n            };\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('Heterogeneous geometries', async () => {\n            const expected = makeFeatureCollectionFromArray([\n                'POINT(1.2 -2.1)',\n                'LINESTRING(1.2 -2.1, 2.4 -4.8)',\n                'MULTIPOLYGON (((30 20, 45 40, 10 40, 30 20)))',\n            ]);\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('Long feature properties', async () => {\n            const expected: GeoJsonFeatureCollection = {\n                type: 'FeatureCollection',\n                features: [\n                    {\n                        type: 'Feature',\n                        id: 0,\n                        properties: {\n                            veryLong1: Array(1024 * 10)\n                                .fill('X')\n                                .join(''),\n                            veryLong2: Array(1024 * 10)\n                                .fill('Y')\n                                .join(''),\n                            veryLong3: Array(1024 * 10)\n                                .fill('Z')\n                                .join(''),\n                        },\n                        geometry: {\n                            type: 'Point',\n                            coordinates: [-77.53466, 23.75975],\n                        },\n                    },\n                ],\n            };\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n    });\n\n    describe('Attribute roundtrips', () => {\n        it('Number', async () => {\n            const expected = makeFeatureCollection('POINT(1 1)', {\n                test: 1,\n            });\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('Number with decimals', async () => {\n            const expected = makeFeatureCollection('POINT(1 1)', {\n                test: 1.1,\n            });\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('NumberTwoAttribs', async () => {\n            const expected = makeFeatureCollection('POINT(1 1)', {\n                test1: 1,\n                test2: 1,\n            });\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('NumberWithDecimal', async () => {\n            const expected = makeFeatureCollection('POINT(1 1)', {\n                test: 1.1,\n            });\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('Boolean', async () => {\n            const expected = makeFeatureCollection('POINT(1 1)', {\n                test: true,\n            });\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('String', async () => {\n            const expected = makeFeatureCollection('POINT(1 1)', {\n                test: 'test',\n            });\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('Mixed', async () => {\n            const expected = makeFeatureCollection('POINT(1 1)', {\n                test1: 1,\n                test2: 1.1,\n                test3: 'test',\n                test4: true,\n            });\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('Json Value', async () => {\n            const expected = makeFeatureCollection('POINT(1 1)', {\n                test: { hello: 'world' },\n            });\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n\n        it('Binary', async () => {\n            const expected = makeFeatureCollection('POINT(1 1)', {\n                test: new Uint8Array([116, 101, 115, 116]),\n            });\n            const actual = await takeAsync<IGeoJsonFeature>(deserialize(serialize(expected)));\n            expect(actual).to.deep.equal(expected.features);\n        });\n    });\n\n    describe('Prepared buffers tests', () => {\n        it('Should parse countries fgb produced from GDAL byte array', async () => {\n            const buffer = readFileSync('./test/data/countries.fgb');\n            const bytes = new Uint8Array(buffer);\n            let headerMeta: HeaderMeta | undefined;\n            const features = await takeAsync<IGeoJsonFeature>(\n                deserialize(bytes, undefined, (header: HeaderMeta) => (headerMeta = header)),\n            );\n            expect(headerMeta?.crs?.code).to.eq(4326);\n            expect(features.length).to.eq(179);\n            for (const f of features) {\n                const g = f.geometry as Point | MultiPoint | LineString | MultiLineString | Polygon | MultiPolygon;\n                expect((g.coordinates[0] as Position[]).length).to.be.greaterThan(0);\n            }\n        });\n\n        it('Should parse countries fgb produced from GDAL stream filter', async () => {\n            const r: Rect = { minX: 12, minY: 56, maxX: 12, maxY: 56 };\n            const features = await takeAsync<IGeoJsonFeature>(\n                deserialize('https://flatgeobuf.septima.dk/countries.fgb', r, undefined, false),\n            );\n            expect(features.length).to.eq(3);\n            for (const f of features)\n                expect(((f.geometry as Polygon).coordinates[0] as Position[]).length).to.be.greaterThan(0);\n        });\n\n        it('Should parse countries fgb produced from GDAL stream no filter', async () => {\n            const buffer = readFileSync('./test/data/countries.fgb');\n            const bytes = new Uint8Array(buffer);\n            const stream = arrayToStream(bytes.buffer);\n            const features = await takeAsync<IGeoJsonFeature>(deserialize(stream));\n            expect(features.length).to.eq(179);\n            for (const f of features)\n                expect(((f.geometry as Polygon).coordinates[0] as Position[]).length).to.be.greaterThan(0);\n        });\n\n        it('Should parse UScounties fgb produced from GDAL', async () => {\n            const buffer = readFileSync('./test/data/UScounties.fgb');\n            const bytes = new Uint8Array(buffer);\n            const features = await takeAsync<IGeoJsonFeature>(deserialize(bytes));\n            expect(features.length).to.eq(3221);\n            for (const f of features) {\n                const g = f.geometry as Point | MultiPoint | LineString | MultiLineString | Polygon | MultiPolygon;\n                expect((g.coordinates[0] as number[]).length).to.be.greaterThan(0);\n            }\n        });\n\n        it('Should parse heterogeneous fgb produced from Rust impl', async () => {\n            const buffer = readFileSync('./test/data/heterogeneous.fgb');\n            const bytes = new Uint8Array(buffer);\n            const features = await takeAsync<IGeoJsonFeature>(deserialize(bytes));\n            const expected = {\n                type: 'FeatureCollection',\n                features: [\n                    {\n                        type: 'Feature',\n                        id: 0,\n                        properties: {},\n                        geometry: { type: 'Point', coordinates: [1.2, -2.1] },\n                    },\n                    {\n                        type: 'Feature',\n                        id: 1,\n                        properties: {},\n                        geometry: {\n                            type: 'LineString',\n                            coordinates: [\n                                [1.2, -2.1],\n                                [2.4, -4.8],\n                            ],\n                        },\n                    },\n                    {\n                        type: 'Feature',\n                        id: 2,\n                        properties: {},\n                        geometry: {\n                            type: 'MultiPolygon',\n                            coordinates: [\n                                [\n                                    [\n                                        [30, 20],\n                                        [45, 40],\n                                        [10, 40],\n                                        [30, 20],\n                                    ],\n                                ],\n                            ],\n                        },\n                    },\n                ],\n            };\n            expect(features).to.deep.equal(expected.features);\n        });\n    });\n\n    describe('Spatial filter', () => {\n        it('Should filter by rect when using byte array', async () => {\n            const buffer = readFileSync('./test/data/UScounties.fgb');\n            const bytes = new Uint8Array(buffer);\n            const rect: Rect = {\n                minX: -106.88,\n                minY: 36.75,\n                maxX: -101.11,\n                maxY: 41.24,\n            };\n            const features = await takeAsync<IGeoJsonFeature>(deserialize(bytes, rect));\n            expect(features.length).toBe(86);\n            const actual = features.slice(0, 4).map((f) => `${f.properties?.NAME}, ${f.properties?.STATE}`);\n            const expected = ['Texas, OK', 'Cimarron, OK', 'Taos, NM', 'Colfax, NM'];\n            expect(actual).toEqual(expected);\n        });\n\n        it('Should filter overlapping multipoly as expected', async () => {\n            const buffer = readFileSync('./test/data/mp_overlapping.fgb');\n            const bytes = new Uint8Array(buffer);\n            const rect: Rect = {\n                minX: 14.9,\n                minY: 55.1,\n                maxX: 14.9,\n                maxY: 55.1,\n            };\n            const features = await takeAsync<IGeoJsonFeature>(deserialize(bytes, rect));\n            expect(features.length).toBe(2);\n        });\n    });\n});\n"],"names":["readFileSync","GeometryFactory","GeoJSONWriter","WKTReader","describe","expect","it","deserialize","serialize","arrayToStream","takeAsync","makeFeatureCollection","wkt","properties","makeFeatureCollectionFromArray","wkts","reader","writer","features","geometries","map","write","read","geometry","index","type","id","f","expected","s","to","deep","equal","stream","name","coordinates","veryLong1","Array","fill","join","veryLong2","veryLong3","test","test1","test2","test3","test4","hello","Uint8Array","headerMeta","bytes","undefined","header","crs","code","eq","length","g","be","greaterThan","minX","minY","maxX","maxY","buffer","toBe","slice","NAME","STATE","toEqual"],"mappings":"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"}