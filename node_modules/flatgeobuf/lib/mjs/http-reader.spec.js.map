{"version":3,"sources":["../../../../src/ts/http-reader.spec.ts"],"sourcesContent":["import Lws from 'lws';\nimport { afterAll, beforeAll, describe, expect, it } from 'vitest';\nimport { fromFeature, type IGeoJsonFeature } from './geojson/feature';\nimport { HttpReader } from './http-reader';\n\ndescribe('http reader', () => {\n    let lws: Lws;\n    beforeAll(async () => {\n        lws = await Lws.create({ stack: ['lws-range', 'lws-static'] });\n    });\n    afterAll(() => {\n        if (lws) lws.server.close();\n    });\n\n    it('fetches a subset of data based on bounding box', async () => {\n        const testUrl = `http://localhost:${lws.config.port}/test/data/UScounties.fgb`;\n        const rect = {\n            minX: -106.88,\n            minY: 36.75,\n            maxX: -101.11,\n            maxY: 41.24,\n        };\n        const reader = await HttpReader.open(testUrl, false);\n\n        const features: IGeoJsonFeature[] = [];\n        for await (const feature of reader.selectBbox(rect)) {\n            features.push(fromFeature(feature.id, feature.feature, reader.header));\n        }\n        expect(features.length).toBe(86);\n        const actual = features.slice(0, 4).map((f) => `${f.properties?.NAME}, ${f.properties?.STATE}`);\n        const expected = ['Cheyenne, KS', 'Rawlins, KS', 'Yuma, CO', 'Washington, CO'];\n        expect(actual).toEqual(expected);\n    });\n\n    it('can fetch the final feature', async () => {\n        const testUrl = `http://localhost:${lws.config.port}/test/data/countries.fgb`;\n        const rect = {\n            minX: -61.2,\n            minY: -51.85,\n            maxX: -60.0,\n            maxY: -51.25,\n        };\n        const reader = await HttpReader.open(testUrl, true);\n        expect(179).toBe(reader.header.featuresCount);\n\n        let featureCount = 0;\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        for await (const _feature of reader.selectBbox(rect)) {\n            featureCount++;\n        }\n        expect(featureCount).toBe(2);\n    });\n});\n"],"names":["Lws","afterAll","beforeAll","describe","expect","it","fromFeature","HttpReader","lws","create","stack","server","close","testUrl","config","port","reader","open","features","feature","selectBbox","minX","minY","maxX","maxY","push","id","header","length","toBe","slice","map","f","properties","NAME","STATE","toEqual","featuresCount","featureCount","_feature"],"mappings":"AAAA,OAAOA,MAAS,KAAM,AACtB,QAASC,YAAAA,CAAQ,CAAEC,aAAAA,CAAS,CAAEC,YAAAA,CAAQ,CAAEC,UAAAA,CAAM,CAAEC,MAAAA,CAAE,KAAQ,QAAS,AACnE,QAASC,eAAAA,CAAW,KAA8B,mBAAoB,AACtE,QAASC,cAAAA,CAAU,KAAQ,eAAgB,CAE3CJ,EAAS,cAAe,KACpB,IAAIK,EACJN,EAAU,UACNM,EAAM,MAAMR,EAAIS,MAAM,CAAC,CAAEC,MAAO,CAAC,YAAa,aAAa,AAAC,EAChE,GACAT,EAAS,KACDO,GAAKA,EAAIG,MAAM,CAACC,KAAK,EAC7B,GAEAP,EAAG,iDAAkD,UACjD,IAAMQ,EAAU,CAAC,iBAAiB,EAAEL,EAAIM,MAAM,CAACC,IAAI,CAAC,yBAAyB,CAAC,CAOxEC,EAAS,MAAMT,EAAWU,IAAI,CAACJ,EAAS,CAAA,GAExCK,EAA8B,EAAE,CACtC,UAAW,IAAMC,KAAWH,EAAOI,UAAU,CAThC,CACTC,KAAM,QACNC,KAAM,MACNC,KAAM,QACNC,KAAM,KACV,GAKIN,EAASO,IAAI,CAACnB,EAAYa,EAAQO,EAAE,CAAEP,EAAQA,OAAO,CAAEH,EAAOW,MAAM,GAExEvB,EAAOc,EAASU,MAAM,EAAEC,IAAI,CAAC,IAG7BzB,EAFec,EAASY,KAAK,CAAC,EAAG,GAAGC,GAAG,CAAC,AAACC,GAAM,CAAC,EAAEA,EAAEC,UAAU,EAAEC,KAAK,EAAE,EAAEF,EAAEC,UAAU,EAAEE,MAAM,CAAC,GAE/EC,OAAO,CADL,CAAC,eAAgB,cAAe,WAAY,iBAAiB,CAElF,GAEA/B,EAAG,8BAA+B,UAC9B,IAAMQ,EAAU,CAAC,iBAAiB,EAAEL,EAAIM,MAAM,CAACC,IAAI,CAAC,wBAAwB,CAAC,CAOvEC,EAAS,MAAMT,EAAWU,IAAI,CAACJ,EAAS,CAAA,GAC9CT,EAAO,KAAKyB,IAAI,CAACb,EAAOW,MAAM,CAACU,aAAa,EAE5C,IAAIC,EAAe,EAEnB,UAAW,IAAMC,KAAYvB,EAAOI,UAAU,CAXjC,CACTC,KAAM,MACNC,KAAM,OACNC,KAAM,IACNC,KAAM,MACV,GAOIc,IAEJlC,EAAOkC,GAAcT,IAAI,CAAC,EAC9B,EACJ"}