{"version":3,"sources":["../../../../../src/ts/ol/geometry.ts"],"sourcesContent":["import type { GeometryLayout } from 'ol/geom/Geometry.js';\nimport LineString from 'ol/geom/LineString.js';\nimport MultiLineString from 'ol/geom/MultiLineString.js';\nimport MultiPoint from 'ol/geom/MultiPoint.js';\nimport MultiPolygon from 'ol/geom/MultiPolygon.js';\nimport Point from 'ol/geom/Point.js';\nimport Polygon from 'ol/geom/Polygon.js';\nimport type { Geometry } from '../flat-geobuf/geometry.js';\nimport { GeometryType } from '../flat-geobuf/geometry-type.js';\nimport type { ISimpleGeometry } from '../generic/geometry.js';\n\nfunction interleaveZ(flatCoordinates: number[], z: number[]): number[] {\n    const newFlatCoordinates = new Array(flatCoordinates.length + z.length);\n    for (let i = 0, j = 0, k = 0; i < flatCoordinates.length; i += 2, j++) {\n        newFlatCoordinates[k++] = flatCoordinates[i];\n        newFlatCoordinates[k++] = flatCoordinates[i + 1];\n        newFlatCoordinates[k++] = z[j];\n    }\n    return newFlatCoordinates;\n}\n\nfunction interleaveZM(flatCoordinates: number[], z: number[], m: number[]): number[] {\n    const newFlatCoordinates = new Array(flatCoordinates.length + z.length + m.length);\n    for (let i = 0, j = 0, k = 0; i < flatCoordinates.length; i += 2, j++) {\n        newFlatCoordinates[k++] = flatCoordinates[i];\n        newFlatCoordinates[k++] = flatCoordinates[i + 1];\n        newFlatCoordinates[k++] = z[j];\n        newFlatCoordinates[k++] = m[j];\n    }\n    return newFlatCoordinates;\n}\n\nexport function createGeometry(geometry: Geometry | null, headerGeomType: GeometryType): ISimpleGeometry | undefined {\n    let geomType: GeometryType | undefined;\n    if (headerGeomType === GeometryType.Unknown) {\n        geomType = geometry?.type();\n    } else {\n        geomType = headerGeomType;\n    }\n\n    if (!geometry) return;\n    const xyArray = geometry.xyArray();\n    if (xyArray) {\n        let flatCoordinates = Array.from(xyArray);\n        const z = geometry.zArray();\n        const m = geometry.mArray();\n        const ends = geometry.endsArray();\n        let layout: GeometryLayout = 'XY';\n        let endsMultiplier = 2;\n        if (z && m) {\n            layout = 'XYZM';\n            flatCoordinates = interleaveZM(flatCoordinates, Array.from(z), Array.from(m));\n            endsMultiplier = 4;\n        } else if (z) {\n            layout = 'XYZ';\n            flatCoordinates = interleaveZ(flatCoordinates, Array.from(z));\n            endsMultiplier = 3;\n        } else if (m) {\n            layout = 'XYM';\n            flatCoordinates = interleaveZ(flatCoordinates, Array.from(m));\n            endsMultiplier = 3;\n        }\n        const olEnds = ends ? Array.from(ends.map((e) => e * endsMultiplier)) : [flatCoordinates.length];\n        switch (geomType) {\n            case GeometryType.Point:\n                return new Point(flatCoordinates);\n            case GeometryType.MultiPoint:\n                return new MultiPoint(flatCoordinates, layout);\n            case GeometryType.LineString:\n                return new LineString(flatCoordinates, layout);\n            case GeometryType.MultiLineString:\n                return new MultiLineString(flatCoordinates, layout, olEnds);\n            case GeometryType.Polygon:\n                return new Polygon(flatCoordinates, layout, olEnds);\n        }\n    }\n    if (geomType === GeometryType.MultiPolygon) {\n        const partsLength = geometry.partsLength();\n        const polygons = new Array<Polygon>(partsLength);\n        for (let i = 0; i < partsLength; i++) {\n            polygons[i] = createGeometry(geometry.parts(i) as Geometry, GeometryType.Polygon) as Polygon;\n        }\n        return new MultiPolygon(polygons);\n    }\n\n    throw new Error('Unknown type');\n}\n"],"names":["LineString","MultiLineString","MultiPoint","MultiPolygon","Point","Polygon","GeometryType","interleaveZ","flatCoordinates","z","newFlatCoordinates","Array","length","i","j","k","createGeometry","geometry","headerGeomType","geomType","Unknown","type","xyArray","from","zArray","m","mArray","ends","endsArray","layout","endsMultiplier","interleaveZM","olEnds","map","e","partsLength","polygons","parts","Error"],"mappings":"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"}