{"version":3,"sources":["../../../../../src/ts/ol/featurecollection.ts"],"sourcesContent":["import type { Extent } from 'ol/extent.js';\nimport Feature from 'ol/Feature.js';\nimport { transformExtent } from 'ol/proj.js';\nimport type RenderFeature from 'ol/render/Feature.js';\nimport type { IFeature } from '../generic/feature.js';\nimport {\n    type FromFeatureFn,\n    deserialize as genericDeserialize,\n    deserializeFiltered as genericDeserializeFiltered,\n    deserializeStream as genericDeserializeStream,\n    serialize as genericSerialize,\n} from '../generic/featurecollection.js';\nimport type { HeaderMetaFn } from '../generic.js';\nimport type { Rect } from '../packedrtree.js';\nimport { getFromFeatureFn } from './feature.js';\n\nexport interface FeatureCollectionOptions {\n    /**\n     * Feature class to be used when creating features. The default is Feature.\n     * If performance is the primary concern and features are not going to be\n     * modified, consider using RenderFeature (Circle and GeometryCollection are\n     * not supported. As coordinates are flattened, multi geometries and polygons\n     * with holes are not well rendered).\n     * Default to ol/Feature.\n     */\n    featureClass: typeof Feature | typeof RenderFeature;\n    /** Data projection. Defaults to EPSG:4326 */\n    dataProjection: string;\n    /** Header to request the file from. Defaults to an empty object. */\n    headers: HeadersInit;\n    /** Disable caching of the file. Defaults to false. */\n    nocache: boolean;\n    /** Feature projection. Defaults to undefined (no conversion). */\n    featureProjection?: string;\n    /** Callback that will receive header metadata when available. Defaults to undefined. */\n    headerMetaFn?: HeaderMetaFn;\n}\n\nexport class FeatureCollection {\n    private options: FeatureCollectionOptions;\n\n    constructor(options?: Partial<FeatureCollectionOptions>) {\n        this.options = {\n            ...{\n                featureClass: Feature,\n                dataProjection: 'EPSG:4326',\n                headers: {},\n                nocache: false,\n            },\n            ...options,\n        };\n    }\n\n    getHeaders(): HeadersInit {\n        return this.options.headers;\n    }\n\n    setOptions(options: Partial<FeatureCollectionOptions>): void {\n        this.options = {\n            ...this.options,\n            ...options,\n        };\n    }\n\n    getRect(extent: Extent): Rect {\n        const [minX, minY, maxX, maxY] =\n            this.options.featureProjection && this.options.dataProjection !== this.options.featureProjection\n                ? transformExtent(extent, this.options.dataProjection, this.options.featureProjection)\n                : extent;\n        return { minX, minY, maxX, maxY };\n    }\n\n    serialize(features: IFeature[]): Uint8Array {\n        return genericSerialize(features);\n    }\n\n    async *deserialize(bytes: Uint8Array, rect?: Rect): AsyncGenerator<IFeature> {\n        yield* genericDeserialize(bytes, this.getFromFeatureFn(), rect, this.options.headerMetaFn);\n    }\n\n    deserializeStream(stream: ReadableStream): AsyncGenerator<IFeature> {\n        return genericDeserializeStream(stream, this.getFromFeatureFn(), this.options.headerMetaFn);\n    }\n\n    deserializeFiltered(url: string, rect: Rect): AsyncGenerator<IFeature> {\n        return genericDeserializeFiltered(\n            url,\n            rect,\n            this.getFromFeatureFn(),\n            this.options.headerMetaFn,\n            this.options.nocache,\n            this.options.headers,\n        );\n    }\n\n    private getFromFeatureFn(): FromFeatureFn {\n        return getFromFeatureFn(this.options.featureClass, this.options.dataProjection, this.options.featureProjection);\n    }\n}\n"],"names":["Feature","transformExtent","deserialize","genericDeserialize","deserializeFiltered","genericDeserializeFiltered","deserializeStream","genericDeserializeStream","serialize","genericSerialize","getFromFeatureFn","FeatureCollection","options","featureClass","dataProjection","headers","nocache","getHeaders","setOptions","getRect","extent","minX","minY","maxX","maxY","featureProjection","features","bytes","rect","headerMetaFn","stream","url"],"mappings":"AACA,OAAOA,MAAa,eAAgB,AACpC,QAASC,mBAAAA,CAAe,KAAQ,YAAa,AAG7C,QAEIC,eAAeC,CAAkB,CACjCC,uBAAuBC,CAA0B,CACjDC,qBAAqBC,CAAwB,CAC7CC,aAAaC,CAAgB,KAC1B,iCAAkC,AAGzC,QAASC,oBAAAA,CAAgB,KAAQ,cAAe,AAwBhD,QAAO,MAAMC,kBACT,AAAQC,OAAkC,AAE1C,aAAYA,CAA2C,CAAE,CACrD,IAAI,CAACA,OAAO,CAAG,CAEPC,aAAcb,EACdc,eAAgB,YAChBC,QAAS,CAAC,EACVC,QAAS,CAAA,EAEb,GAAGJ,CAAO,AACd,CACJ,CAEAK,YAA0B,CACtB,OAAO,IAAI,CAACL,OAAO,CAACG,OAAO,AAC/B,CAEAG,WAAWN,CAA0C,CAAQ,CACzD,IAAI,CAACA,OAAO,CAAG,CACX,GAAG,IAAI,CAACA,OAAO,CACf,GAAGA,CAAO,AACd,CACJ,CAEAO,QAAQC,CAAc,CAAQ,CAC1B,GAAM,CAACC,EAAMC,EAAMC,EAAMC,EAAK,CAC1B,IAAI,CAACZ,OAAO,CAACa,iBAAiB,EAAI,IAAI,CAACb,OAAO,CAACE,cAAc,GAAK,IAAI,CAACF,OAAO,CAACa,iBAAiB,CAC1FxB,EAAgBmB,EAAQ,IAAI,CAACR,OAAO,CAACE,cAAc,CAAE,IAAI,CAACF,OAAO,CAACa,iBAAiB,EACnFL,EACV,MAAO,CAAEC,KAAAA,EAAMC,KAAAA,EAAMC,KAAAA,EAAMC,KAAAA,CAAK,CACpC,CAEAhB,UAAUkB,CAAoB,CAAc,CACxC,OAAOjB,EAAiBiB,EAC5B,CAEA,OAAOxB,YAAYyB,CAAiB,CAAEC,CAAW,CAA4B,CACzE,MAAOzB,EAAmBwB,EAAO,IAAI,CAACjB,gBAAgB,GAAIkB,EAAM,IAAI,CAAChB,OAAO,CAACiB,YAAY,CAC7F,CAEAvB,kBAAkBwB,CAAsB,CAA4B,CAChE,OAAOvB,EAAyBuB,EAAQ,IAAI,CAACpB,gBAAgB,GAAI,IAAI,CAACE,OAAO,CAACiB,YAAY,CAC9F,CAEAzB,oBAAoB2B,CAAW,CAAEH,CAAU,CAA4B,CACnE,OAAOvB,EACH0B,EACAH,EACA,IAAI,CAAClB,gBAAgB,GACrB,IAAI,CAACE,OAAO,CAACiB,YAAY,CACzB,IAAI,CAACjB,OAAO,CAACI,OAAO,CACpB,IAAI,CAACJ,OAAO,CAACG,OAAO,CAE5B,CAEA,AAAQL,kBAAkC,CACtC,OAAOA,EAAiB,IAAI,CAACE,OAAO,CAACC,YAAY,CAAE,IAAI,CAACD,OAAO,CAACE,cAAc,CAAE,IAAI,CAACF,OAAO,CAACa,iBAAiB,CAClH,CACJ"}