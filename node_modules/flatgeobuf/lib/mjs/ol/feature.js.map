{"version":3,"sources":["../../../../../src/ts/ol/feature.ts"],"sourcesContent":["import OlFeature from 'ol/Feature.js';\nimport { transformGeometryWithOptions } from 'ol/format/Feature.js';\nimport RenderFeature, { type Type } from 'ol/render/Feature.js';\nimport type { Feature } from '../flat-geobuf/feature.js';\nimport {\n    fromFeature as genericFromFeature,\n    type ICreateFeature,\n    type IFeature,\n    type IProperties,\n} from '../generic/feature.js';\nimport type { FromFeatureFn } from '../generic/featurecollection';\nimport type { ISimpleGeometry } from '../generic/geometry.js';\nimport type { HeaderMeta } from '../header-meta.js';\nimport { createGeometry } from './geometry.js';\n\nfunction getCreateFeatureFn(dataProjection: string, featureProjection?: string): ICreateFeature {\n    return function createFeature(id: number, geometry?: ISimpleGeometry, properties?: IProperties): IFeature {\n        const olFeature = new OlFeature(geometry);\n        if (featureProjection && dataProjection !== featureProjection) {\n            olFeature.getGeometry()?.transform(dataProjection, featureProjection);\n        }\n        olFeature.setId(id);\n        const feature = olFeature as IFeature;\n        if (properties && feature.setProperties) feature.setProperties(properties);\n        return feature;\n    };\n}\n\nfunction getCreateRenderFeatureFn(dataProjection: string, featureProjection?: string): ICreateFeature {\n    return function createRenderFeature(id: number, geometry?: ISimpleGeometry, properties?: IProperties): IFeature {\n        const geometryType = geometry?.getType() === 'MultiPolygon' ? 'Polygon' : geometry?.getType();\n        if (geometryType === 'GeometryCollection' || geometryType === 'Circle') {\n            throw new Error(`Unsupported geometry type: ${geometryType}`);\n        }\n        const flatCoordinates = geometry?.getFlatCoordinates?.();\n        const stride = geometry?.getLayout?.().length;\n        if (!flatCoordinates || !stride) {\n            throw new Error(`Geometry without coordinates: ${geometry}`);\n        }\n        const renderFeature = new RenderFeature(\n            geometryType as Type,\n            flatCoordinates,\n            [flatCoordinates.length],\n            stride,\n            properties || {},\n            id,\n        );\n        return transformGeometryWithOptions(renderFeature.enableSimplifyTransformed(), false, {\n            dataProjection,\n            featureProjection,\n        }) as IFeature;\n    };\n}\n\nexport function getFromFeatureFn(\n    classType: typeof OlFeature | typeof RenderFeature = OlFeature,\n    dataProjection = 'EPSG:4326',\n    featureProjection?: string,\n): FromFeatureFn {\n    let createFeatureFn: ICreateFeature;\n    if (classType === RenderFeature) {\n        createFeatureFn = getCreateRenderFeatureFn(dataProjection, featureProjection);\n    } else {\n        createFeatureFn = getCreateFeatureFn(dataProjection, featureProjection);\n    }\n    return (id: number, feature: Feature, header: HeaderMeta) =>\n        genericFromFeature(id, feature, header, createGeometry, createFeatureFn);\n}\n"],"names":["OlFeature","transformGeometryWithOptions","RenderFeature","fromFeature","genericFromFeature","createGeometry","getFromFeatureFn","classType","dataProjection","featureProjection","createFeatureFn","id","geometry","properties","geometryType","getType","Error","flatCoordinates","getFlatCoordinates","stride","getLayout","length","renderFeature","enableSimplifyTransformed","olFeature","getGeometry","transform","setId","feature","setProperties","header"],"mappings":"AAAA,OAAOA,MAAe,eAAgB,AACtC,QAASC,gCAAAA,CAA4B,KAAQ,sBAAuB,AACpE,QAAOC,MAAkC,sBAAuB,AAEhE,QACIC,eAAeC,CAAkB,KAI9B,uBAAwB,AAI/B,QAASC,kBAAAA,CAAc,KAAQ,eAAgB,AAyC/C,QAAO,SAASC,iBACZC,EAAqDP,CAAS,CAC9DQ,EAAiB,WAAW,CAC5BC,CAA0B,EAE1B,IAAIC,EAMJ,OAJIA,EADAH,IAAcL,EA/BX,SAA6BS,CAAU,CAAEC,CAA0B,CAAEC,CAAwB,EAChG,IAAMC,EAAeF,GAAUG,YAAc,eAAiB,UAAYH,GAAUG,UACpF,GAAID,AAAiB,uBAAjBA,GAAyCA,AAAiB,WAAjBA,EACzC,MAAM,AAAIE,MAAM,CAAC,2BAA2B,EAAEF,EAAa,CAAC,EAEhE,IAAMG,EAAkBL,GAAUM,uBAC5BC,EAASP,GAAUQ,cAAcC,OACvC,GAAI,CAACJ,GAAmB,CAACE,EACrB,MAAM,AAAIH,MAAM,CAAC,8BAA8B,EAAEJ,EAAS,CAAC,EAU/D,OAAOX,EAA6BqB,AARd,IAAIpB,EACtBY,EACAG,EACA,CAACA,EAAgBI,MAAM,CAAC,CACxBF,EACAN,GAAc,CAAC,EACfF,GAE8CY,yBAAyB,GAAI,CAAA,EAAO,CAClFf,eAauCA,EAZvCC,kBAYuDA,CAX3D,EACJ,EAnCO,SAAuBE,CAAU,CAAEC,CAA0B,CAAEC,CAAwB,EAC1F,IAAMW,EAAY,IAAIxB,EAAUY,UAC5BH,AA6CiDA,GA7C5BD,AA6CYA,IAAgBC,GA5CjDe,EAAUC,WAAW,IAAIC,UA4CQlB,EAAgBC,GA1CrDe,EAAUG,KAAK,CAAChB,GAEZE,GAAce,AADFJ,EACUK,aAAa,EAAED,AADzBJ,EACiCK,aAAa,CAAChB,GAD/CW,CAGpB,EAwCO,CAACb,EAAYiB,EAAkBE,IAClC1B,EAAmBO,EAAIiB,EAASE,EAAQzB,EAAgBK,EAChE"}