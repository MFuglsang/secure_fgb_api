import{readFileSync as t}from"node:fs";import e from"ol/Feature.js";import a from"ol/format/GeoJSON.js";import o from"ol/format/WKT.js";import{transform as l}from"ol/proj";import n from"ol/render/Feature.js";import{describe as i,expect as r,it as s}from"vitest";import{deserialize as u,FeatureCollection as y,serialize as P}from"./ol.js";import{arrayToStream as g,takeAsync as c}from"./streams/utils.js";let p=new o,w=new a,L=t=>w.writeFeatures(t);function M(t){return m([t])}function m(t){return t.map(t=>p.readGeometry(t)).map((t,a)=>{let o=new e({geometry:t});return o.setId(a),o})}i("ol module",()=>{i("Geometry roundtrips",()=>{let e=new y;s("Point",async()=>{let t=M("POINT(1.2 -2.1)"),a=P(e,t);r(L(await c(u(e,a)))).to.equal(L(t))}),s("Point via stream",async()=>{let t=M("POINT(1.2 -2.1)"),a=g(P(e,t));r(L(await c(u(e,a)))).to.equal(L(t))}),s("Point Z",async()=>{let t=M("POINT Z(1.2 -2.1 5)"),a=P(e,t);r(L(await c(u(e,a)))).to.equal(L(t))}),s("Point M",async()=>{let t=M("POINT M(1.2 -2.1 5)"),a=P(e,t);r(L(await c(u(e,a)))).to.equal(L(t))}),s("Point ZM",async()=>{let t=M("POINT ZM(1.2 -2.1 5 12.8)"),a=P(e,t);r(L(await c(u(e,a)))).to.equal(L(t))}),s("Points",async()=>{let t=m(["POINT(1.2 -2.1)","POINT(2.4 -4.8)"]);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("Points Z",async()=>{let t=m(["POINT Z(1.2 -2.1 5)","POINT Z(2.4 -4.8 5.6)"]);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiPoint",async()=>{let t=M("MULTIPOINT(10 40, 40 30, 20 20, 30 10)");r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiPoint Z",async()=>{let t=M("MULTIPOINT Z(10 40 0.5, 40 30 0.5, 20 20 0.5, 30 10 0.5)");r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiPoint ZM",async()=>{let t=M("MULTIPOINT ZM(10 40 0.5 1, 40 30 0.5 1, 20 20 0.5 1, 30 10 0.5 1)");r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("LineString",async()=>{let t=M("LINESTRING(1.2 -2.1, 2.4 -4.8)");r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("LineString Z",async()=>{let t=M("LINESTRING Z(1.2 -2.1 5, 2.4 -4.8 0.5)");r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("LineString ZM",async()=>{let t=M("LINESTRING ZM(1.2 -2.1 5 1, 2.4 -4.8 0.5 1)");r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiLineString",async()=>{let t=M(`MULTILINESTRING((10 10, 20 20, 10 40),
 (40 40, 30 30, 40 20, 30 10), (50 50, 60 60, 50 90))`);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiLineString Z",async()=>{let t=M(`MULTILINESTRING Z((10 10 5, 20 20 0.5, 10 40 12.1),
 (40 40 4, 30 30 3, 40 20 2, 30 10 1), (50 50 5, 60 60 6, 50 90 9))`);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiLineString ZM",async()=>{let t=M(`MULTILINESTRING ZM((10 10 5 1, 20 20 0.5 1, 10 40 12.1 1),
 (40 40 4 1, 30 30 3 1, 40 20 2 1, 30 10 1 2), (50 50 5 1, 60 60 6 1, 50 90 9 1))`);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiLineStringSinglePart",async()=>{let t=M("MULTILINESTRING((1.2 -2.1, 2.4 -4.8))");r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("Polygon",async()=>{let t=M("POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))");r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("Polygon Z",async()=>{let t=M("POLYGON Z((30 10 12.1, 40 40 4, 20 40 4, 10 20 0.5, 30 10 12))");r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("Polygon ZM",async()=>{let t=M("POLYGON ZM((30 10 12.1 1, 40 40 4 1, 20 40 4 1, 10 20 0.5 1, 30 10 12 1))");r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("PolygonWithHole",async()=>{let t=M(`POLYGON ((35 10, 45 45, 15 40, 10 20, 35 10),
 (20 30, 35 35, 30 20, 20 30))`);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("PolygonWithHole Z",async()=>{let t=M(`POLYGON Z ((35 10 4, 45 45 4, 15 40 4, 10 20 4, 35 10 4),
 (20 30 4, 35 35 4, 30 20 4, 20 30 4))`);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("PolygonWithHole ZM",async()=>{let t=M(`POLYGON ZM ((35 10 4 1, 45 45 4 1, 15 40 4 1, 10 20 4 1, 35 10 4 1),
 (20 30 4 1, 35 35 4 1, 30 20 4 1, 20 30 4 1))`);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("PolygonWithTwoHoles",async()=>{let t=M(`POLYGON ((35 10, 45 45, 15 40, 10 20, 35 10),
 (20 30, 35 35, 30 20, 20 30), (20 30, 35 35, 30 20, 20 30))`);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiPolygon",async()=>{let t=M(`MULTIPOLYGON (((30 20, 45 40, 10 40, 30 20)),
 ((15 5, 40 10, 10 20, 5 10, 15 5)))`);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiPolygon Z",async()=>{let t=M(`MULTIPOLYGON Z (((30 20 1, 45 40 3, 10 40 4, 30 20 6)),
 ((15 5 1, 40 10 1, 10 20 1, 5 10 1, 15 5 1)))`);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiPolygon ZM",async()=>{let t=M(`MULTIPOLYGON ZM (((30 20 1 2, 45 40 3 2, 10 40 4 2, 30 20 6 2)),
 ((15 5 1 2, 40 10 1 2, 10 20 1 2, 5 10 1 2, 15 5 1 2)))`);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiPolygonWithHole",async()=>{let t=M(`MULTIPOLYGON (((40 40, 20 45, 45 30, 40 40)),
 ((20 35, 10 30, 10 10, 30 5, 45 20, 20 35), (30 20, 20 15, 20 25, 30 20)))`);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiPolygonWithHole Z",async()=>{let t=M(`MULTIPOLYGON Z(((40 40 1, 20 45 1, 45 30 1, 40 40 1)),
 ((20 35 1, 10 30 1, 10 10 1, 30 5 1, 45 20 1, 20 35 1), (30 20 1, 20 15 1, 20 25 1, 30 20 1)))`);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiPolygonWithHole ZM",async()=>{let t=M(`MULTIPOLYGON ZM (((40 40 1 2, 20 45 1 2, 45 30 1 2, 40 40 1 2)),
 ((20 35 1 2, 10 30 1 2, 10 10 1 2, 30 5 1 2, 45 20 1 2, 20 35 1 2), (30 20 1 2, 20 15 1 2, 20 25 1 2, 30 20 1 2)))`);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiPolygonSinglePart",async()=>{let t=M("MULTIPOLYGON (((30 20, 45 40, 10 40, 30 20)))");r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiPolygonSinglePartWithHole",async()=>{let t=M(`MULTIPOLYGON (((35 10, 45 45, 15 40, 10 20, 35 10),
 (20 30, 35 35, 30 20, 20 30))))`);r(L(await c(u(e,P(e,t))))).to.equal(L(t))}),s("MultiPolygon with two holes",async()=>{let t={type:"FeatureCollection",features:[{type:"Feature",id:0,properties:{test:1},geometry:{type:"MultiPolygon",coordinates:[[[[102,2],[103,2],[103,3],[102,3],[102,2]]],[[[100,0],[101,0],[101,1],[100,1],[100,0]],[[100.2,.2],[100.8,.2],[100.8,.8],[100.2,.8],[100.2,.2]]]]}}]};r(JSON.parse(L(await c(u(e,P(e,w.readFeatures(t))))))).to.deep.equal(t)}),s("Should parse UScounties fgb produced from GDAL array buffer",async()=>{let a=new Uint8Array(t("./test/data/UScounties.fgb")),o=await c(u(e,a));for(let t of(r(o.length).to.eq(3221),o))r(t.getGeometry().getCoordinates()?.length).to.be.greaterThan(0)}),s("Should parse countries fgb produced from GDAL array buffer",async()=>{let a=new Uint8Array(t("./test/data/countries.fgb")),o=await c(u(e,a));for(let t of(r(o.length).to.eq(179),o))r(t.getGeometry().getCoordinates()?.length).to.be.greaterThan(0)}),s("Should parse countries fgb produced from GDAL stream",async()=>{let a=g(new Uint8Array(t("./test/data/countries.fgb")).buffer),o=await c(u(e,a));for(let t of(r(o.length).to.eq(179),o))r(t.getGeometry().getCoordinates()?.length).to.be.greaterThan(0)}),s("Bahamas",async()=>{let t={type:"FeatureCollection",features:[{type:"Feature",id:0,properties:{name:"The Bahamas"},geometry:{type:"MultiPolygon",coordinates:[[[[-77.53466,23.75975],[-77.78,23.71],[-78.03405,24.28615],[-78.40848,24.57564],[-78.19087,25.2103],[-77.89,25.17],[-77.54,24.34],[-77.53466,23.75975]]],[[[-77.82,26.58],[-78.91,26.42],[-78.98,26.79],[-78.51,26.87],[-77.85,26.84],[-77.82,26.58]]],[[[-77,26.59],[-77.17255,25.87918],[-77.35641,26.00735],[-77.34,26.53],[-77.78802,26.92516],[-77.79,27.04],[-77,26.59]]]]}}]};r(JSON.parse(L(await c(u(e,P(e,w.readFeatures(t))))))).to.deep.equal(t)}),s("Heterogeneous geometry types",async()=>{let t={type:"FeatureCollection",features:[{type:"Feature",id:0,properties:{name:"A"},geometry:{type:"Point",coordinates:[-77.53466,23.75975]}},{type:"Feature",id:1,properties:{name:"B"},geometry:{type:"LineString",coordinates:[[-77.53466,23.75975],[-77,26.59]]}}]};r(JSON.parse(L(await c(u(e,P(e,w.readFeatures(t))))))).to.deep.equal(t)}),s("Heterogeneous geometry types Z",async()=>{let t={type:"FeatureCollection",features:[{type:"Feature",id:0,properties:{name:"A"},geometry:{type:"Point",coordinates:[-77.53466,23.75975,12]}},{type:"Feature",id:1,properties:{name:"B"},geometry:{type:"LineString",coordinates:[[-77.53466,23.75975,12],[-77,26.59,12]]}}]};r(JSON.parse(L(await c(u(e,P(e,w.readFeatures(t))))))).to.deep.equal(t)})}),i("Geometry roundtrips with RenderFeatures",()=>{let t=new y({featureClass:n});s("Point",async()=>{let e=P(t,M("POINT(1.2 -2.1)")),a=await c(u(t,e));r(a[0].getType()).toEqual("Point"),r(a[0].getFlatCoordinates()).toEqual([1.2,-2.1])}),s("MultiPoint",async()=>{let e=M("MULTIPOINT(10 40, 40 30, 20 20, 30 10)"),a=await c(u(t,P(t,e)));r(a[0].getType()).toEqual("MultiPoint"),r(a[0].getFlatCoordinates()).toEqual([10,40,40,30,20,20,30,10])}),s("LineString",async()=>{let e=M("LINESTRING(1.2 -2.1, 2.4 -4.8)"),a=await c(u(t,P(t,e)));r(a[0].getType()).toEqual("LineString"),r(a[0].getFlatCoordinates()).toEqual([1.2,-2.1,2.4,-4.8])}),s("Polygon",async()=>{let e=M("POLYGON ((30 10, 40 40, 20 40, 10 20, 30 10))"),a=await c(u(t,P(t,e)));r(a[0].getType()).toEqual("Polygon"),r(a[0].getFlatCoordinates()).toEqual([30,10,40,40,20,40,10,20,30,10])})}),i("Transforms geometry to another projection",()=>{i("Point",()=>{let t=M("POINT(13 56)"),e=l([13,56],"EPSG:4326","EPSG:3857");s("Point to Feature",async()=>{let a=new y({dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),o=P(a,t);r((await c(u(a,o)))[0].getGeometry().getFlatCoordinates()).toEqual(e)}),s("Point to RenderFeature",async()=>{let a=new y({featureClass:n,dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"}),o=P(a,t);r((await c(u(a,o)))[0].getFlatCoordinates()).toEqual(e)})})})});
//# sourceMappingURL=ol.spec.js.map