{"version":3,"sources":["../../../../src/ts/header-meta.ts"],"sourcesContent":["import type * as flatbuffers from 'flatbuffers';\n\nimport type { ColumnMeta } from './column-meta.js';\nimport type { CrsMeta } from './crs-meta.js';\nimport type { GeometryType } from './flat-geobuf/geometry-type.js';\nimport { Header } from './flat-geobuf/header.js';\n\nexport interface HeaderMeta {\n    geometryType: GeometryType;\n    columns: ColumnMeta[] | null;\n    envelope: Float64Array | null;\n    featuresCount: number;\n    indexNodeSize: number;\n    crs: CrsMeta | null;\n    title: string | null;\n    description: string | null;\n    metadata: string | null;\n}\n\nexport function fromByteBuffer(bb: flatbuffers.ByteBuffer): HeaderMeta {\n    const header = Header.getRootAsHeader(bb);\n    const featuresCount = header.featuresCount();\n    const indexNodeSize = header.indexNodeSize();\n\n    const columns: ColumnMeta[] = [];\n    for (let j = 0; j < header.columnsLength(); j++) {\n        const column = header.columns(j);\n        if (!column) throw new Error('Column unexpectedly missing');\n        if (!column.name()) throw new Error('Column name unexpectedly missing');\n        columns.push({\n            name: column.name() as string,\n            type: column.type(),\n            title: column.title(),\n            description: column.description(),\n            width: column.width(),\n            precision: column.precision(),\n            scale: column.scale(),\n            nullable: column.nullable(),\n            unique: column.unique(),\n            primary_key: column.primaryKey(),\n        });\n    }\n    const crs = header.crs();\n    const crsMeta: CrsMeta | null = crs\n        ? {\n              org: crs.org(),\n              code: crs.code(),\n              name: crs.name(),\n              description: crs.description(),\n              wkt: crs.wkt(),\n              code_string: crs.codeString(),\n          }\n        : null;\n    const headerMeta: HeaderMeta = {\n        geometryType: header.geometryType(),\n        columns: columns,\n        envelope: null,\n        featuresCount: Number(featuresCount),\n        indexNodeSize: indexNodeSize,\n        crs: crsMeta,\n        title: header.title(),\n        description: header.description(),\n        metadata: header.metadata(),\n    };\n    return headerMeta;\n}\n"],"names":["Header","fromByteBuffer","bb","header","getRootAsHeader","featuresCount","indexNodeSize","columns","j","columnsLength","column","Error","name","push","type","title","description","width","precision","scale","nullable","unique","primary_key","primaryKey","crs","crsMeta","org","code","wkt","code_string","codeString","geometryType","envelope","Number","metadata"],"mappings":"AAKA,OAASA,UAAAA,CAAM,KAAQ,yBAA0B,AAcjD,QAAO,SAASC,eAAeC,CAA0B,EACrD,IAAMC,EAASH,EAAOI,eAAe,CAACF,GAChCG,EAAgBF,EAAOE,aAAa,GACpCC,EAAgBH,EAAOG,aAAa,GAEpCC,EAAwB,EAAE,CAChC,IAAK,IAAIC,EAAI,EAAGA,EAAIL,EAAOM,aAAa,GAAID,IAAK,CAC7C,IAAME,EAASP,EAAOI,OAAO,CAACC,GAC9B,GAAI,CAACE,EAAQ,MAAM,AAAIC,MAAM,+BAC7B,GAAI,CAACD,EAAOE,IAAI,GAAI,MAAM,AAAID,MAAM,oCACpCJ,EAAQM,IAAI,CAAC,CACTD,KAAMF,EAAOE,IAAI,GACjBE,KAAMJ,EAAOI,IAAI,GACjBC,MAAOL,EAAOK,KAAK,GACnBC,YAAaN,EAAOM,WAAW,GAC/BC,MAAOP,EAAOO,KAAK,GACnBC,UAAWR,EAAOQ,SAAS,GAC3BC,MAAOT,EAAOS,KAAK,GACnBC,SAAUV,EAAOU,QAAQ,GACzBC,OAAQX,EAAOW,MAAM,GACrBC,YAAaZ,EAAOa,UAAU,EAClC,EACJ,CACA,IAAMC,EAAMrB,EAAOqB,GAAG,GAChBC,EAA0BD,EAC1B,CACIE,IAAKF,EAAIE,GAAG,GACZC,KAAMH,EAAIG,IAAI,GACdf,KAAMY,EAAIZ,IAAI,GACdI,YAAaQ,EAAIR,WAAW,GAC5BY,IAAKJ,EAAII,GAAG,GACZC,YAAaL,EAAIM,UAAU,EAC/B,EACA,KAYN,MAX+B,CAC3BC,aAAc5B,EAAO4B,YAAY,GACjCxB,QAASA,EACTyB,SAAU,KACV3B,cAAe4B,OAAO5B,GACtBC,cAAeA,EACfkB,IAAKC,EACLV,MAAOZ,EAAOY,KAAK,GACnBC,YAAab,EAAOa,WAAW,GAC/BkB,SAAU/B,EAAO+B,QAAQ,EAC7B,CAEJ"}